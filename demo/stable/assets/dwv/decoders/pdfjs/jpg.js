"use strict";var JpegImage=function(){var e=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),n=4017,r=799,a=3406,t=2276,o=1567,i=3784,c=5793,s=2896,l=-2056,f=2024,u=255;function h(){}function v(e,n){var r,a,t=0,o=[],i=16;while(i>0&&!e[i-1])i--;o.push({children:[],index:0});var c,s=o[0];for(r=0;r<i;r++){for(a=0;a<e[r];a++){s=o.pop(),s.children[s.index]=n[t];while(s.index>0)s=o.pop();s.index++,o.push(s);while(o.length<=r)o.push(c={children:[],index:0}),s.children[s.index]=c.children,s=c;t++}r+1<i&&(o.push(c={children:[],index:0}),s.children[s.index]=c.children,s=c)}return o[0].children}function m(e,n,r){return 64*((e.blocksPerLine+1)*n+r)}function b(n,r,a,t,o,i,c,s,l){var f=a.mcusPerLine,u=a.progressive,h=r,v=0,b=0;function k(){if(b>0)return b--,v>>b&1;if(v=n[r++],255===v){var e=n[r++];if(e)throw"unexpected marker: "+(v<<8|e).toString(16)}return b=7,v>>>7}function p(e){var n=e;while(1){if(n=n[k()],"number"===typeof n)return n;if("object"!==typeof n)throw"invalid huffman sequence"}}function d(e){var n=0;while(e>0)n=n<<1|k(),e--;return n}function w(e){if(1===e)return 1===k()?1:-1;var n=d(e);return n>=1<<e-1?n:n+(-1<<e)+1}function g(n,r){var a=p(n.huffmanTableDC),t=0===a?0:w(a);n.blockData[r]=n.pred+=t;var o=1;while(o<64){var i=p(n.huffmanTableAC),c=15&i,s=i>>4;if(0!==c){o+=s;var l=e[o];n.blockData[r+l]=w(c),o++}else{if(s<15)break;o+=16}}}function C(e,n){var r=p(e.huffmanTableDC),a=0===r?0:w(r)<<l;e.blockData[n]=e.pred+=a}function D(e,n){e.blockData[n]|=k()<<l}var P=0;function T(n,r){if(P>0)P--;else{var a=i,t=c;while(a<=t){var o=p(n.huffmanTableAC),s=15&o,f=o>>4;if(0!==s){a+=f;var u=e[a];n.blockData[r+u]=w(s)*(1<<l),a++}else{if(f<15){P=d(f)+(1<<f)-1;break}a+=16}}}}var y,L=0;function x(n,r){var a,t,o=i,s=c,f=0;while(o<=s){var u=e[o];switch(L){case 0:if(t=p(n.huffmanTableAC),a=15&t,f=t>>4,0===a)f<15?(P=d(f)+(1<<f),L=4):(f=16,L=1);else{if(1!==a)throw"invalid ACn encoding";y=w(a),L=f?2:3}continue;case 1:case 2:n.blockData[r+u]?n.blockData[r+u]+=k()<<l:(f--,0===f&&(L=2===L?3:0));break;case 3:n.blockData[r+u]?n.blockData[r+u]+=k()<<l:(n.blockData[r+u]=y<<l,L=0);break;case 4:n.blockData[r+u]&&(n.blockData[r+u]+=k()<<l);break}o++}4===L&&(P--,0===P&&(L=0))}function A(e,n,r,a,t){var o=r/f|0,i=r%f,c=o*e.v+a,s=i*e.h+t,l=m(e,c,s);n(e,l)}function _(e,n,r){var a=r/e.blocksPerLine|0,t=r%e.blocksPerLine,o=m(e,a,t);n(e,o)}var I,z,U,q,Y,M,R=t.length;M=u?0===i?0===s?C:D:0===s?T:x:g;var H,V,j,J,S=0;V=1===R?t[0].blocksPerLine*t[0].blocksPerColumn:f*a.mcusPerColumn,o||(o=V);while(S<V){for(z=0;z<R;z++)t[z].pred=0;if(P=0,1===R)for(I=t[0],Y=0;Y<o;Y++)_(I,M,S),S++;else for(Y=0;Y<o;Y++){for(z=0;z<R;z++)for(I=t[z],j=I.h,J=I.v,U=0;U<J;U++)for(q=0;q<j;q++)A(I,M,S,U,q);S++}if(b=0,H=n[r]<<8|n[r+1],H<=65280)throw"marker was not found";if(!(H>=65488&&H<=65495))break;r+=2}return r-h}function k(e,h,v){for(var m,b,k,p,d,w,g,C,D,P,T,y,L,x,A,_,I,z=e.quantizationTable,U=e.blockData,q=0;q<64;q+=8)D=U[h+q],P=U[h+q+1],T=U[h+q+2],y=U[h+q+3],L=U[h+q+4],x=U[h+q+5],A=U[h+q+6],_=U[h+q+7],D*=z[q],0!==(P|T|y|L|x|A|_)?(P*=z[q+1],T*=z[q+2],y*=z[q+3],L*=z[q+4],x*=z[q+5],A*=z[q+6],_*=z[q+7],m=c*D+128>>8,b=c*L+128>>8,k=T,p=A,d=s*(P-_)+128>>8,C=s*(P+_)+128>>8,w=y<<4,g=x<<4,m=m+b+1>>1,b=m-b,I=k*i+p*o+128>>8,k=k*o-p*i+128>>8,p=I,d=d+g+1>>1,g=d-g,C=C+w+1>>1,w=C-w,m=m+p+1>>1,p=m-p,b=b+k+1>>1,k=b-k,I=d*t+C*a+2048>>12,d=d*a-C*t+2048>>12,C=I,I=w*r+g*n+2048>>12,w=w*n-g*r+2048>>12,g=I,v[q]=m+C,v[q+7]=m-C,v[q+1]=b+g,v[q+6]=b-g,v[q+2]=k+w,v[q+5]=k-w,v[q+3]=p+d,v[q+4]=p-d):(I=c*D+512>>10,v[q]=I,v[q+1]=I,v[q+2]=I,v[q+3]=I,v[q+4]=I,v[q+5]=I,v[q+6]=I,v[q+7]=I);for(var Y=0;Y<8;++Y)D=v[Y],P=v[Y+8],T=v[Y+16],y=v[Y+24],L=v[Y+32],x=v[Y+40],A=v[Y+48],_=v[Y+56],0!==(P|T|y|L|x|A|_)?(m=c*D+2048>>12,b=c*L+2048>>12,k=T,p=A,d=s*(P-_)+2048>>12,C=s*(P+_)+2048>>12,w=y,g=x,m=m+b+1>>1,b=m-b,I=k*i+p*o+2048>>12,k=k*o-p*i+2048>>12,p=I,d=d+g+1>>1,g=d-g,C=C+w+1>>1,w=C-w,m=m+p+1>>1,p=m-p,b=b+k+1>>1,k=b-k,I=d*t+C*a+2048>>12,d=d*a-C*t+2048>>12,C=I,I=w*r+g*n+2048>>12,w=w*n-g*r+2048>>12,g=I,D=m+C,_=m-C,P=b+g,A=b-g,T=k+w,x=k-w,y=p+d,L=p-d,D=D<=l?0:D>=f?u:D-l>>4,P=P<=l?0:P>=f?u:P-l>>4,T=T<=l?0:T>=f?u:T-l>>4,y=y<=l?0:y>=f?u:y-l>>4,L=L<=l?0:L>=f?u:L-l>>4,x=x<=l?0:x>=f?u:x-l>>4,A=A<=l?0:A>=f?u:A-l>>4,_=_<=l?0:_>=f?u:_-l>>4,U[h+Y]=D,U[h+Y+8]=P,U[h+Y+16]=T,U[h+Y+24]=y,U[h+Y+32]=L,U[h+Y+40]=x,U[h+Y+48]=A,U[h+Y+56]=_):(I=c*D+8192>>14,I=I<=l?0:I>=f?u:I-l>>4,U[h+Y]=I,U[h+Y+8]=I,U[h+Y+16]=I,U[h+Y+24]=I,U[h+Y+32]=I,U[h+Y+40]=I,U[h+Y+48]=I,U[h+Y+56]=I)}function p(e,n){for(var r=n.blocksPerLine,a=n.blocksPerColumn,t=new Int32Array(64),o=0;o<a;o++)for(var i=0;i<r;i++){var c=m(n,o,i);k(n,c,t)}return n.blockData}function d(e){return e<=0?0:e>=255?255:e}return h.prototype={parse:function(n){function r(){var e=n[c]<<8|n[c+1];return c+=2,e}function a(){var e=r(),a=n.subarray(c,c+e-2);return c+=a.length,a}function t(e){for(var n=Math.ceil(e.samplesPerLine/8/e.maxH),r=Math.ceil(e.scanLines/8/e.maxV),a=0;a<e.components.length;a++){B=e.components[a];var t=Math.ceil(Math.ceil(e.samplesPerLine/8)*B.h/e.maxH),o=Math.ceil(Math.ceil(e.scanLines/8)*B.v/e.maxV),i=n*B.h,c=r*B.v,s=64*c*(i+1);B.blockData=new Int16Array(s),B.blocksPerLine=t,B.blocksPerColumn=o}e.mcusPerLine=n,e.mcusPerColumn=r}var o,i,c=0,s=null,h=null,m=[],k=[],d=[],w=r();if(65496!==w)throw"SOI not found";w=r();while(65497!==w){var g,C,D;switch(w){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var P=a();65504===w&&74===P[0]&&70===P[1]&&73===P[2]&&70===P[3]&&0===P[4]&&(s={version:{major:P[5],minor:P[6]},densityUnits:P[7],xDensity:P[8]<<8|P[9],yDensity:P[10]<<8|P[11],thumbWidth:P[12],thumbHeight:P[13],thumbData:P.subarray(14,14+3*P[12]*P[13])}),65518===w&&65===P[0]&&100===P[1]&&111===P[2]&&98===P[3]&&101===P[4]&&(h={version:P[5]<<8|P[6],flags0:P[7]<<8|P[8],flags1:P[9]<<8|P[10],transformCode:P[11]});break;case 65499:var T,y=r(),L=y+c-2;while(c<L){var x=n[c++],A=new Uint16Array(64);if(x>>4===0)for(C=0;C<64;C++)T=e[C],A[T]=n[c++];else{if(x>>4!==1)throw"DQT: invalid table spec";for(C=0;C<64;C++)T=e[C],A[T]=r()}m[15&x]=A}break;case 65472:case 65473:case 65474:if(o)throw"Only single frame JPEGs supported";r(),o={},o.extended=65473===w,o.progressive=65474===w,o.precision=n[c++];var _=255/((1<<o.precision)-1);l/=_,f/=_,u/=_,o.scanLines=r(),o.samplesPerLine=r(),o.components=[],o.componentIds={};var I,z=n[c++],U=0,q=0;for(g=0;g<z;g++){I=n[c];var Y=n[c+1]>>4,M=15&n[c+1];U<Y&&(U=Y),q<M&&(q=M);var R=n[c+2];D=o.components.push({h:Y,v:M,quantizationTable:m[R],quantizationTableId:R}),o.componentIds[I]=D-1,c+=3}o.maxH=U,o.maxV=q,t(o);break;case 65476:var H=r();for(g=2;g<H;){var V=n[c++],j=new Uint8Array(16),J=0;for(C=0;C<16;C++,c++)J+=j[C]=n[c];var S=new Uint8Array(J);for(C=0;C<J;C++,c++)S[C]=n[c];g+=17+J,(V>>4===0?d:k)[15&V]=v(j,S)}break;case 65501:r(),i=r();break;case 65498:r();var B,E=n[c++],G=[];for(g=0;g<E;g++){var N=o.componentIds[n[c++]];B=o.components[N];var O=n[c++];B.huffmanTableDC=d[O>>4],B.huffmanTableAC=k[15&O],G.push(B)}var X=n[c++],Q=n[c++],W=n[c++],F=b(n,c,o,G,i,X,Q,W>>4,15&W);c+=F;break;case 65535:255!==n[c]&&c--;break;default:if(255===n[c-3]&&n[c-2]>=192&&n[c-2]<=254){c-=3;break}throw"unknown JPEG marker "+w.toString(16)}w=r()}for(this.width=o.samplesPerLine,this.height=o.scanLines,this.jfif=s,this.adobe=h,this.components=[],g=0;g<o.components.length;g++)B=o.components[g],B.quantizationTable||null==B.quantizationTableId||(B.quantizationTable=m[B.quantizationTableId]),this.components.push({output:p(o,B),scaleX:B.h/o.maxH,scaleY:B.v/o.maxV,blocksPerLine:B.blocksPerLine,blocksPerColumn:B.blocksPerColumn});this.numComponents=this.components.length},_getLinearizedBlockData:function(e,n){var r,a,t,o,i,c,s,l,f,u,h,v=this.width/e,m=this.height/n,b=0,k=this.components.length,p=e*n*k,d=new Uint16Array(p),w=new Uint32Array(e),g=4294967288;for(s=0;s<k;s++){for(r=this.components[s],a=r.scaleX*v,t=r.scaleY*m,b=s,h=r.output,o=r.blocksPerLine+1<<3,i=0;i<e;i++)l=0|i*a,w[i]=(l&g)<<3|7&l;for(c=0;c<n;c++)for(l=0|c*t,u=o*(l&g)|(7&l)<<3,i=0;i<e;i++)d[b]=h[u+w[i]],b+=k}var C=this.decodeTransform;if(C)for(s=0;s<p;)for(l=0,f=0;l<k;l++,s++,f+=2)d[s]=(d[s]*C[f]>>8)+C[f+1];return d},_isColorConversionNeeded:function(){return!(!this.adobe||!this.adobe.transformCode)||3===this.numComponents},_convertYccToRgb:function(e){for(var n,r,a,t=0,o=e.length;t<o;t+=3)n=e[t],r=e[t+1],a=e[t+2],e[t]=d(n-179.456+1.402*a),e[t+1]=d(n+135.459-.344*r-.714*a),e[t+2]=d(n-226.816+1.772*r);return e},_convertYcckToRgb:function(e){for(var n,r,a,t,o=0,i=0,c=e.length;i<c;i+=4){n=e[i],r=e[i+1],a=e[i+2],t=e[i+3];var s=r*(-660635669420364e-19*r+.000437130475926232*a-54080610064599e-18*n+.00048449797120281*t-.154362151871126)-122.67195406894+a*(-.000957964378445773*a+.000817076911346625*n-.00477271405408747*t+1.53380253221734)+n*(.000961250184130688*n-.00266257332283933*t+.48357088451265)+t*(-.000336197177618394*t+.484791561490776),l=107.268039397724+r*(219927104525741e-19*r-.000640992018297945*a+.000659397001245577*n+.000426105652938837*t-.176491792462875)+a*(-.000778269941513683*a+.00130872261408275*n+.000770482631801132*t-.151051492775562)+n*(.00126935368114843*n-.00265090189010898*t+.25802910206845)+t*(-.000318913117588328*t-.213742400323665),f=r*(-.000570115196973677*r-263409051004589e-19*a+.0020741088115012*n-.00288260236853442*t+.814272968359295)-20.810012546947+a*(-153496057440975e-19*a-.000132689043961446*n+.000560833691242812*t-.195152027534049)+n*(.00174418132927582*n-.00255243321439347*t+.116935020465145)+t*(-.000343531996510555*t+.24165260232407);e[o++]=d(s),e[o++]=d(l),e[o++]=d(f)}return e},_convertYcckToCmyk:function(e){for(var n,r,a,t=0,o=e.length;t<o;t+=4)n=e[t],r=e[t+1],a=e[t+2],e[t]=d(434.456-n-1.402*a),e[t+1]=d(119.541-n+.344*r+.714*a),e[t+2]=d(481.816-n-1.772*r);return e},_convertCmykToRgb:function(e){for(var n,r,a,t,o=0,i=-16581375,c=1/255/255,s=0,l=e.length;s<l;s+=4){n=e[s],r=e[s+1],a=e[s+2],t=e[s+3];var f=n*(-4.387332384609988*n+54.48615194189176*r+18.82290502165302*a+212.25662451639585*t-72734.4411664936)+r*(1.7149763477362134*r-5.6096736904047315*a-17.873870861415444*t-1401.7366389350734)+a*(-2.5217340131683033*a-21.248923337353073*t+4465.541406466231)-t*(21.86122147463605*t+48317.86113160301),u=n*(8.841041422036149*n+60.118027045597366*r+6.871425592049007*a+31.159100130055922*t-20220.756542821975)+r*(-15.310361306967817*r+17.575251261109482*a+131.35250912493976*t-48691.05921601825)+a*(4.444339102852739*a+9.8632861493405*t-6341.191035517494)-t*(20.737325471181034*t+47890.15695978492),h=n*(.8842522430003296*n+8.078677503112928*r+30.89978309703729*a-.23883238689178934*t-3616.812083916688)+r*(10.49593273432072*r+63.02378494754052*a+50.606957656360734*t-28620.90484698408)+a*(.03296041114873217*a+115.60384449646641*t-49363.43385999684)-t*(22.33816807309886*t+45932.16563550634);e[o++]=f>=0?255:f<=i?0:255+f*c|0,e[o++]=u>=0?255:u<=i?0:255+u*c|0,e[o++]=h>=0?255:h<=i?0:255+h*c|0}return e},getData:function(e,n,r){if(this.numComponents>4)throw"Unsupported color mode";var a=this._getLinearizedBlockData(e,n);if(1===this.numComponents&&r){for(var t=a.length,o=new Uint16Array(3*t),i=0,c=0;c<t;c++){var s=a[c];o[i++]=s,o[i++]=s,o[i++]=s}return o}if(3===this.numComponents)return this._convertYccToRgb(a);if(4===this.numComponents){if(this._isColorConversionNeeded())return r?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(r)return this._convertCmykToRgb(a)}return a}},h}();